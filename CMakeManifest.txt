

SET(LOCAL_MF "")
SET(LOCAL_MFDEF "")

foreach(SOURCE_FILE ${MODULE_FILES})
        get_filename_component(FILE_NAME "${SOURCE_FILE}" NAME_WE)
        set(GENERATED_OUTPUT_FILE "${CMAKE_CURRENT_BINARY_DIR}/generated_files/gen_${FILE_NAME}.h")

        add_custom_command(
            OUTPUT "${GENERATED_OUTPUT_FILE}"
            COMMAND manifesto ARGS "${SOURCE_FILE}" "${GENERATED_OUTPUT_FILE}"
            DEPENDS "${SOURCE_FILE}"
            COMMENT "Generating manifest of ${SOURCE_FILE}"
        )
        # Add the generated file to a list for later use in target
        list(APPEND GENERATED_FILES "${GENERATED_OUTPUT_FILE}")
        get_filename_component(FILE_BASENAME ${SOURCE_FILE} NAME_WE)
        string(APPEND LOCAL_MF "MOD(${FILE_BASENAME}),")
        string(APPEND LOCAL_MFDEF "MODDEF(${FILE_BASENAME}) ")
endforeach()


SET(MODULE_FUNCTIONS  "${MODULE_FUNCTIONS} ${LOCAL_MF}" CACHE INTERNAL "MODULE_FUNCTIONS")
SET(MODULE_FUNCTIONS_DEFS  "${MODULE_FUNCTIONS_DEFS} ${LOCAL_MFDEF}" CACHE INTERNAL "MODULE_FUNCTIONS_DEFS")
